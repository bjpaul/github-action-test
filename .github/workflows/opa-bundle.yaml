name: opa-bundle-ci
on:
    workflow_dispatch:
jobs:
    opa-bundle:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout code
              uses: actions/checkout@v4
              with:
                sparse-checkout: |
                  .github
                  opa

            - name: Set up OPA
              uses: open-policy-agent/setup-opa@v2
              with:
                  version: 0.67.1

            - name: Run OPA Test
              run: |
                  opa test ./opa/

            - name: Run OPA Bundle
              run: |
                  opa run --bundle ./bundle.tar.gz --server --set=decision_logs.console=true